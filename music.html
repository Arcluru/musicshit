<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Vault v2.1</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Syncopate:wght@700&family=Outfit:wght@300;400;600&display=swap');

        :root {
            --bg: #050508;
            --accent-1: #ff007a;
            --accent-2: #bc13fe;
            --accent-3: #00d4ff;
            --card-glass: rgba(15, 15, 25, 0.7);
        }

        body {
            background-color: var(--bg);
            background-image: 
                radial-gradient(at 0% 0%, rgba(255, 0, 122, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(0, 212, 255, 0.15) 0px, transparent 50%),
                radial-gradient(at 50% 50%, rgba(188, 19, 254, 0.05) 0px, transparent 50%);
            color: #fff;
            font-family: 'Outfit', sans-serif;
            margin: 0;
            padding: 40px 20px 120px 20px; /* Added bottom padding for mini player */
            overflow-x: hidden;
        }

        .container { max-width: 1300px; margin: 0 auto; }

        h1 {
            font-family: 'Syncopate', sans-serif;
            text-align: center;
            font-size: clamp(2rem, 8vw, 4rem);
            letter-spacing: 15px;
            margin-bottom: 50px;
            background: linear-gradient(90deg, var(--accent-1), var(--accent-2), var(--accent-3));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 15px rgba(188, 19, 254, 0.5));
            animation: titleGlow 4s infinite alternate;
        }

        @keyframes titleGlow {
            from { filter: drop-shadow(0 0 10px rgba(188, 19, 254, 0.4)); }
            to { filter: drop-shadow(0 0 25px rgba(0, 212, 255, 0.6)); }
        }

        .header-ui {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 30px;
            margin-bottom: 60px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            position: sticky;
            top: 20px;
            z-index: 900;
        }

        #searchInput {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 18px 25px;
            border-radius: 15px;
            color: white;
            font-size: 1.1rem;
            margin-bottom: 20px;
            outline: none;
            transition: 0.4s;
            box-sizing: border-box;
        }

        #searchInput:focus {
            border-color: var(--accent-3);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
        }

        .controls { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }

        .filter-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Syncopate', sans-serif;
            font-size: 10px;
            transition: 0.3s;
        }

        .filter-btn:hover, .filter-btn.active {
            background: white;
            color: black;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255,255,255,0.1);
        }

        .song-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
        }

        .song-card {
            background: var(--card-glass);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 24px;
            padding: 30px;
            position: relative;
            transition: 0.3s;
            cursor: pointer;
        }

        .song-card-wrapper {
            position: relative;
            perspective: 1000px;
        }

        .song-card-content {
            position: relative;
            z-index: 2;
            pointer-events: none;
        }

        .shatter-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .shard {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--card-glass);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 24px;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.6), 
                        0 0 25px rgba(188, 19, 254, 0.4),
                        inset 0 0 20px rgba(255, 255, 255, 0.1);
        }

        /* Active State for Shattered Card */
        .song-card-wrapper.shattered .shard {
            opacity: 1;
        }

        .song-card-wrapper.shattered .song-card {
            opacity: 0;
        }

        .song-card h3 {
            margin: 0 0 15px 0;
            font-size: 1.4rem;
            background: linear-gradient(to right, #fff, #888);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .tag-row { display: flex; gap: 8px; flex-wrap: wrap; }

        .tag {
            font-size: 10px;
            font-weight: 700;
            padding: 6px 14px;
            border-radius: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid transparent;
        }

        .tag-nc { background: rgba(188, 19, 254, 0.1); border-color: var(--accent-2); color: #e0aaff; box-shadow: 0 0 10px rgba(188, 19, 254, 0.2); }
        .tag-g { background: rgba(255, 0, 122, 0.1); border-color: var(--accent-1); color: #ff85a1; }
        .tag-m { background: rgba(0, 212, 255, 0.1); border-color: var(--accent-3); color: #90e0ef; }
        .tag-fav { background: linear-gradient(45deg, var(--accent-1), var(--accent-2)); color: white; border: none; }

        /* ====================
           FULL OVERLAY PLAYER 
           ==================== */
        #playerOverlay {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(5, 5, 8, 0.98);
            border-top: 2px solid var(--accent-2);
            padding: 20px;
            transform: translateY(110%);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 2000;
            box-shadow: 0 -20px 60px rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
        }

        #playerOverlay.active {
            transform: translateY(0);
        }

        .player-wrapper {
            width: 100%;
            max-width: 1200px;
            display: flex;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
        }

        .video-container {
            flex: 2;
            aspect-ratio: 16/9;
            background: black;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(188, 19, 254, 0.2);
        }

        .video-container iframe {
            width: 100%;
            height: 100%;
        }

        .player-info {
            flex: 1;
            min-width: 250px;
        }

        .player-info h2 {
            margin: 0 0 15px 0;
            font-family: 'Syncopate', sans-serif;
            font-size: 1.5rem;
            background: linear-gradient(90deg, var(--accent-1), var(--accent-3));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .ui-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Syncopate', sans-serif;
            font-size: 10px;
            transition: 0.3s;
            margin-right: 10px;
        }

        .ui-btn:hover {
            background: var(--accent-1);
            border-color: var(--accent-1);
            transform: scale(1.05);
        }

        .ui-btn.secondary:hover {
             background: var(--accent-3);
             border-color: var(--accent-3);
        }

        /* ====================
           MINI BOTTOM BAR
           ==================== */
        #miniPlayer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(10, 10, 20, 0.95);
            backdrop-filter: blur(15px);
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            z-index: 1900;
            padding: 15px 30px;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transform: translateY(100%);
            transition: transform 0.3s ease-in-out;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }

        #miniPlayer.visible {
            transform: translateY(0);
        }

        .mini-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .playing-indicator {
            display: flex;
            gap: 3px;
            height: 15px;
            align-items: flex-end;
        }

        .bar {
            width: 3px;
            background: var(--accent-3);
            animation: equalizer 0.5s infinite alternate;
        }
        .bar:nth-child(2) { animation-delay: 0.1s; background: var(--accent-2); }
        .bar:nth-child(3) { animation-delay: 0.2s; background: var(--accent-1); }

        @keyframes equalizer {
            0% { height: 2px; }
            100% { height: 15px; }
        }

        .mini-title {
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
            color: white;
            text-shadow: 0 0 10px rgba(255,255,255,0.3);
        }

        .mini-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .icon-btn {
            background: none;
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
            font-size: 14px;
        }

        .icon-btn:hover {
            background: white;
            color: black;
            box-shadow: 0 0 15px rgba(255,255,255,0.4);
        }

    </style>
</head>
<body>

<div class="container">
    <h1>THE VAULT</h1>

    <div class="header-ui">
        <input type="text" id="searchInput" placeholder="SEARCH TRACKS..." onkeyup="runFilter()">
        <div class="controls">
            <button class="filter-btn active" data-filter="all" onclick="setCategory('all')">ALL</button>
            <button class="filter-btn" data-filter="fav" onclick="setCategory('fav')">FAVORITES</button>
            <button class="filter-btn" data-filter="nc" onclick="setCategory('nc')">NIGHTCORE</button>
            <button class="filter-btn" data-filter="g" onclick="setCategory('g')">VOICE: G</button>
            <button class="filter-btn" data-filter="m" onclick="setCategory('m')">VOICE: M</button>
        </div>
    </div>

    <div class="song-grid" id="songGrid"></div>
</div>

<div id="miniPlayer">
    <div class="mini-info">
        <div class="playing-indicator">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>
        <div class="mini-title" id="miniTitle">Select a track...</div>
    </div>
    <div class="mini-controls">
        <button class="icon-btn" onclick="togglePlay()" title="Play/Pause">
            <span id="playIcon">⏸</span>
        </button>
        <button class="ui-btn secondary" onclick="expandPlayer()">OPEN PLAYER</button>
    </div>
</div>

<div id="playerOverlay">
    <div class="player-wrapper">
        <div class="video-container">
            <div id="youtube-frame"></div>
        </div>
        <div class="player-info">
            <h2 id="nowPlaying">Now Playing</h2>
            <p style="color: #aaa; margin-bottom: 20px;">Now playing from The Vault.</p>
            <button class="ui-btn" onclick="minimizePlayer()">MINIMIZE (KEEP PLAYING)</button>
        </div>
    </div>
</div>

<script>
   const songs = [
        { title: "Rockefeller Street", tags: ["nc", "g", "fav"], videoId: "hjGZLnja1o8" },
        { title: "I Got No Time", tags: ["m", "nc"], videoId: "YREhVveHq9k" },
        { title: "Never Be Alone", tags: ["g", "nc"], videoId: "uQpKzPCBqc4" },
        { title: "Rasputin", tags: ["m"], videoId: "16y1AkoZkmQ" },
        { title: "I Can't Decide", tags: ["m"], videoId: "buYrBbwyCGE" },
        { title: "It's Been So Long", tags: ["m", "nc"], videoId: "qt2Ht_Tl9Ic" },
        { title: "Eye of the Tiger", tags: ["m"], videoId: "btPJPFnesV4" },
        { title: "Pretty Scene Girl", tags: ["g"], videoId: "P8F1RjcWLjM" },
        { title: "Kiss Me Again", tags: ["g"], videoId: "IDQYlsDqpAU" },
        { title: "Bad Boy", tags: ["nc", "m"], videoId: "cmlCuzn_mqI" },
        { title: "Just Dance", tags: ["nc", "g"], videoId: "uc2KgPZ2Neo" },
        { title: "Lucky Lucky", tags: ["g", "nc"], videoId: "25fsQofab9c" },
        { title: "Faster N Harder", tags: ["nc", "g"], videoId: "BTksETlbL8E" },
        { title: "Crucified", tags: ["g"], videoId: "cKlBnjlpLIM" },
        { title: "Shinitai-chan", tags: ["g"], videoId: "ucsadKDNTQA" },
        { title: "Judas", tags: ["g"], videoId: "LO-TTgN-nAQ" },
        { title: "Sweet Dreams", tags: ["g", "nc"], videoId: "bG9z-atG7gc" },
        { title: "How Do You Do", tags: ["nc", "g"], videoId: "0GEX_sVwUn4" },
        { title: "Caramelldansen", tags: ["nc", "g"], videoId: "A67ZkAd1wmI" },
        { title: "Every Time We Touch", tags: ["nc", "g"], videoId: "2ziqtyseR3M" },
        { title: "God is a Girl", tags: ["nc", "g"], videoId: "_sB26zkNg2I" },
        { title: "Doktorspiele", tags: ["g", "nc"], videoId: "Yd39WHBYjFk" },
        { title: "Doktorspiele (Original)", tags: ["g"], videoId: "8jpr1Ma183Y" },
        { title: "When You Leave", tags: ["nc", "m"], videoId: "KmDQuwJWs84" },
        { title: "Pretty Little Psycho", tags: ["nc", "g"], videoId: "BByMzI1YjKA" },
        { title: "Sweet Little Bumblebee", tags: ["nc", "g"], videoId: "z3OKd5b2Rlw" },
        { title: "Pretty Rave Girl", tags: ["nc", "g"], videoId: "WaNwvukxz64" },
        { title: "Stereo Love", tags: ["nc"], videoId: "jeJcpGw64sI" },
        { title: "I'm Good (Blue)", tags: ["g", "nc"], videoId: "uVCV3agIGm0" },
        { title: "Naughty Naughty", tags: ["g", "nc"], videoId: "lXnw5hrc1bs" },
        { title: "Right Round", tags: ["nc"], videoId: "blBDU7G0_Oo" },
        { title: "How To Be A Heartbreaker", tags: ["g"], videoId: "O6NvsM49N6w" },
        { title: "Monster", tags: ["m", "nc"], videoId: "KheI_qHGT1o" },
        { title: "Angel With A Shotgun", tags: ["m", "nc"], videoId: "cvaIgq5j2Q8" },
        { title: "My Heart Beats Like A Drum", tags: ["nc", "g"], videoId: "1yyTxvzeGuw" },
        { title: "Cherry Gum", tags: ["g"], videoId: "nBfcuerhYog" },
        { title: "I Like The Way You Kiss Me", tags: ["m"], videoId: "9ReSX1vakUk" },
        { title: "Waiting For Love", tags: ["m", "nc"], videoId: "Ni0bXuKvvT8" },
        { title: "Butterfly", tags: ["nc", "g"], videoId: "NhndeYcXRHA" },
        { title: "Solo", tags: ["nc", "g"], videoId: "XGUS7VnLvZU" },
        { title: "Discord", tags: ["m", "nc"], videoId: "5Z56MZFMp0k" },
        { title: "Around The World", tags: ["g", "nc"], videoId: "8qFwk-lvvXs" },
        { title: "Bad Apple", tags: ["g", "nc"], videoId: "rQg2qngyIZM" },
        { title: "18", tags: ["g"], videoId: "-mh0vism1c4" },
        { title: "Wrap Me In Plastic", tags: ["g", "nc"], videoId: "V_DeCu4PZFA" },
        { title: "Bubblegum Bitch", tags: ["g"], videoId: "lz7ohfQ9ah8" },
        { title: "Ancient Dreams", tags: ["g"], videoId: "_V17JN76uxc" },
        { title: "My Jealousy", tags: ["g"], videoId: "g_7sHcgR_rs" },
        { title: "My Jealousy (Nightcore)", tags: ["g", "nc"], videoId: "u7Qpu8rc4Hk" },
        { title: "Lay All Your Love On Me", tags: ["g"], videoId: "ulZQTrV8QlQ" },
        { title: "Parade", tags: ["m"], videoId: "APIKVLw1tT0" },
        { title: "My Life Is A Party", tags: ["m"], videoId: "sok8kp_DSqE" },
        { title: "Kings & Queens (NC)", tags: ["g", "nc"], videoId: "0X7rw11LBdo" },
        { title: "Kings & Queens", tags: ["g"], videoId: "jH1RNk8954Q" },
        { title: "Beautiful Day", tags: ["g"], videoId: "Q2g6L03FNPQ" },
        { title: "Solo Tu", tags: ["g", "nc"], videoId: "3SJJrnafioI" },
        { title: "Friday", tags: ["g"], videoId: "IHC1Ma6EBbE" },
        { title: "The Labyrinth", tags: ["nc"], videoId: "oCMRGbnXYps" },
        { title: "See How I Circle", tags: ["nc"], videoId: "skHfLY-L2Lw" },
        { title: "Gone For Good", tags: ["nc", "g"], videoId: "pQmqgHs1WCY" },
        { title: "Full Moon", tags: ["nc", "g"], videoId: "mLwRXWZwtq4" },
        { title: "Escaping Gravity", tags: ["nc"], videoId: "5FGaI7lG8gE" },
        { title: "Devil's Lullaby", tags: ["nc", "g"], videoId: "uqjKsBAHkaw" },
        { title: "Drum Go Dum", tags: ["nc", "g"], videoId: "hKTvSvoBu8k" },
        { title: "Who Is She?", tags: ["m"], videoId: "VR-EiEBqfWw" },
        { title: "Who Is She? (NC)", tags: ["nc"], videoId: "4ERNSBXq334" },
        { title: "All I Want Is You", tags: ["m", "nc"], videoId: "v2-PN87uD9U" },
        { title: "6 Little Eggs", tags: ["m"], videoId: "M8uCgvRN6tg" },
        { title: "Roses Are Red", tags: ["g", "nc"], videoId: "5HSWvFs3OMA" },
        { title: "Love For You", tags: ["g"], videoId: "nQVaRFP-ppw" },
        { title: "From Paris to Berlin", tags: ["g"], videoId: "THt5u-i2d9k" },
        { title: "Love You Like a Love Song", tags: ["g", "nc"], videoId: "ZzfEBeLXERs" },
        { title: "Dam Dadi Do", tags: ["nc"], videoId: "6SCQyBcHeDg" },
        { title: "I Love You So", tags: ["g"], videoId: "SGF8dhihicU" },
        { title: "Monster (Sped Up)", tags: ["m"], videoId: "-5MgGG_P23c" },
        { title: "Winter 4Ever", tags: ["g", "nc"], videoId: "rj0i5G2ZdZ4" },
        { title: "Gold", tags: ["m"], videoId: "ntG50eXbBtc" },
        { title: "I Really Want to Stay", tags: ["g"], videoId: "h4VJGNNSQnw" },
        { title: "Hero Rider Jeans", tags: ["m"], videoId: "swv4p88dxSY" },
        { title: "Washing Machine Heart", tags: ["g", "nc"], videoId: "mu2rVefKIJ8" },
        { title: "Oh My Little Baby Boy", tags: ["g", "nc"], videoId: "ARsQAfQSHTc" },
        { title: "Partners In Crime", tags: ["nc"], videoId: "4UdepnkstAU" },
        { title: "I Don't Know", tags: ["nc"], videoId: "fhwVE9xYEzw" },
        { title: "Ready or Not", tags: ["g", "nc"], videoId: "ZWkO_M6vWBw" },
        { title: "Cheri Cheri Lady", tags: ["nc"], videoId: "wamz_k2JYLo" },
        { title: "The World We Knew", tags: ["m"], videoId: "dthgRdTf0Ds" },
        { title: "My Ordinary Life", tags: ["m"], videoId: "MURua52_YPg" },
        { title: "Don't Stop The Music", tags: ["g", "nc"], videoId: "IXrEzetT0Gs" },
        { title: "Angel of Darkness", tags: ["nc"], videoId: "BWNmLW_ddIk" },
        { title: "Dark Red", tags: ["nc"], videoId: "rJ02AzDgvX0" },
        { title: "House Of Memories", tags: ["nc"], videoId: "OZqwTzPJeC4" },
        { title: "Bass Slut", tags: ["g"], videoId: "ZhJBNjbk0ds" },
        { title: "Gossip", tags: ["m", "nc"], videoId: "7MJ-pUrMeYw" },
        { title: "Lovefool", tags: ["g", "nc"], videoId: "VKsNKWuoUk8" },
        { title: "Paint It Black", tags: ["nc"], videoId: "AKlAPTpJCRA" },
        { title: "I'm So Crazy For You", tags: ["m"], videoId: "iRZEQoMk3B0" },
        { title: "All I Ever Wanted", tags: ["m"], videoId: "P3CxhBIrBho" }
    ];

    let currentCategory = 'all';
    let currentShattered = null;
    let player; // YouTube Player Object
    let isPlayerReady = false;
    let isPlaying = false;

    // --- YOUTUBE API SETUP ---
    // This loads the IFrame Player API code asynchronously.
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('youtube-frame', {
            height: '100%',
            width: '100%',
            videoId: '', // Start empty
            playerVars: {
                'playsinline': 1,
                'rel': 0,
                'enablejsapi': 1,
                'origin': window.location.origin
            },
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
    }

    function onPlayerReady(event) {
        isPlayerReady = true;
    }

    function onPlayerStateChange(event) {
        const playIcon = document.getElementById('playIcon');
        if (event.data == YT.PlayerState.PLAYING) {
            isPlaying = true;
            playIcon.textContent = "⏸";
        } else {
            isPlaying = false;
            playIcon.textContent = "▶";
        }
    }

    // --- PLAYER CONTROLS ---

    function startTrack(videoId, title) {
        if (!isPlayerReady) return;
        
        // Load video
        player.loadVideoById(videoId);
        
        // Update Titles
        document.getElementById('nowPlaying').textContent = title;
        document.getElementById('miniTitle').textContent = title;
        
        // Show Full Player
        expandPlayer();
    }

    function minimizePlayer() {
        document.getElementById('playerOverlay').classList.remove('active');
        document.getElementById('miniPlayer').classList.add('visible');
    }

    function expandPlayer() {
        document.getElementById('miniPlayer').classList.remove('visible');
        document.getElementById('playerOverlay').classList.add('active');
    }

    function togglePlay() {
        if (!isPlayerReady) return;
        if (isPlaying) {
            player.pauseVideo();
        } else {
            player.playVideo();
        }
    }

    // --- UI & SHATTER LOGIC ---

    function createShards(wrapper, content, videoId, title) {
        const container = document.createElement('div');
        container.className = 'shatter-container';
        
        const shards = [
            { clip: 'polygon(0 0, 35% 0, 25% 30%, 0 25%)', transform: 'translate(-8px, -8px) rotate(-3deg)' },
            { clip: 'polygon(35% 0, 65% 0, 55% 25%, 25% 30%)', transform: 'translate(0, -12px) rotate(2deg)' },
            { clip: 'polygon(65% 0, 100% 0, 100% 20%, 75% 28%, 55% 25%)', transform: 'translate(10px, -10px) rotate(-4deg)' },
            { clip: 'polygon(0 25%, 25% 30%, 20% 55%, 0 50%)', transform: 'translate(-12px, 0) rotate(2deg)' },
            { clip: 'polygon(25% 30%, 55% 25%, 60% 45%, 45% 60%, 20% 55%)', transform: 'translate(0, 5px) rotate(-2deg)' },
            { clip: 'polygon(55% 25%, 75% 28%, 70% 50%, 60% 45%)', transform: 'translate(8px, 0) rotate(3deg)' },
            { clip: 'polygon(75% 28%, 100% 20%, 100% 45%, 70% 50%)', transform: 'translate(15px, 0) rotate(-3deg)' },
            { clip: 'polygon(70% 50%, 100% 45%, 100% 70%, 75% 72%)', transform: 'translate(12px, 5px) rotate(2deg)' },
            { clip: 'polygon(0 50%, 20% 55%, 15% 78%, 0 75%)', transform: 'translate(-10px, 8px) rotate(-2deg)' },
            { clip: 'polygon(20% 55%, 45% 60%, 40% 85%, 15% 78%)', transform: 'translate(-5px, 10px) rotate(3deg)' },
            { clip: 'polygon(45% 60%, 60% 65%, 55% 90%, 40% 85%)', transform: 'translate(0, 15px) rotate(-3deg)' },
            { clip: 'polygon(60% 65%, 75% 72%, 70% 95%, 55% 90%)', transform: 'translate(5px, 12px) rotate(2deg)' },
            { clip: 'polygon(75% 72%, 100% 70%, 100% 100%, 70% 95%)', transform: 'translate(15px, 15px) rotate(-4deg)' },
            { clip: 'polygon(15% 78%, 40% 85%, 55% 90%, 70% 95%, 100% 100%, 0 100%)', transform: 'translate(0, 18px) rotate(0deg)' }
        ];

        shards.forEach(shard => {
            const piece = document.createElement('div');
            piece.className = 'shard';
            piece.style.clipPath = shard.clip;
            piece.innerHTML = content;
            piece.dataset.transform = shard.transform;
            container.appendChild(piece);
        });

        wrapper.appendChild(container);
        
        wrapper.addEventListener('click', () => {
            // 1. Repair the previously shattered card (if exists and isn't this one)
            if (currentShattered && currentShattered !== wrapper) {
                currentShattered.classList.remove('shattered');
                const oldShards = currentShattered.querySelectorAll('.shard');
                oldShards.forEach(s => s.style.transform = 'translate(0, 0) rotate(0deg)');
            }
            
            // 2. Shatter the clicked card (ensure it's active)
            wrapper.classList.add('shattered');
            const newShards = wrapper.querySelectorAll('.shard');
            newShards.forEach(s => s.style.transform = s.dataset.transform);
            
            // 3. Update state and play
            currentShattered = wrapper;
            startTrack(videoId, title);
        });
    }

    function renderSongs() {
        const grid = document.getElementById('songGrid');
        grid.innerHTML = songs.map(song => {
            const content = `
                <h3>${song.title}</h3>
                <div class="tag-row">
                    ${song.tags.map(t => `<span class="tag tag-${t}">${t === 'nc' ? 'Nightcore' : t.toUpperCase()}</span>`).join('')}
                </div>
            `;
            
            return `
                <div class="song-card-wrapper" data-title="${song.title.toLowerCase()}" data-tags="${song.tags.join(' ')}">
                    <div class="song-card">
                        <div class="song-card-content">${content}</div>
                    </div>
                </div>
            `;
        }).join('');

        document.querySelectorAll('.song-card-wrapper').forEach((wrapper, index) => {
            const song = songs[index];
            const content = wrapper.querySelector('.song-card-content').innerHTML;
            createShards(wrapper, content, song.videoId, song.title);
        });
    }

    function setCategory(cat) {
        currentCategory = cat;
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.toggle('active', btn.getAttribute('data-filter') === cat);
        });
        runFilter();
    }

    function runFilter() {
        const searchVal = document.getElementById('searchInput').value.toLowerCase();
        const cards = document.querySelectorAll('.song-card-wrapper');

        cards.forEach(card => {
            const title = card.getAttribute('data-title');
            const tags = card.getAttribute('data-tags').split(' ');
            
            const matchesSearch = title.includes(searchVal) || tags.some(t => t.includes(searchVal));
            const matchesCategory = currentCategory === 'all' || tags.includes(currentCategory);

            if (matchesSearch && matchesCategory) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }

    renderSongs();
</script>
</body>
</html>